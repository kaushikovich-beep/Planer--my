
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>ðŸŽ„ Neon Planner Pro</title>
    
    <!-- PWA & Mobile Meta -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f0c29">
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22Neon%20Planner%20Pro%22,%22short_name%22:%22Neon%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22background_color%22:%22#0f0c29%22,%22theme_color%22:%22#ffd700%22}">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
      @keyframes neonPulse {
        0%, 100% { opacity: 0.8; text-shadow: 0 0 5px #ffd700, 0 0 10px #ffd700; }
        50% { opacity: 1; text-shadow: 0 0 10px #ffd700, 0 0 20px #ffd700; }
      }
      @keyframes toySwing {
        0%, 100% { transform: rotate(-5deg); transform-origin: top center; }
        50% { transform: rotate(5deg); transform-origin: top center; }
      }
      @keyframes rainGlow {
        0%, 100% { opacity: 0.3; }
        50% { opacity: 0.8; }
      }
      
      .neon-text-pulse { animation: neonPulse 2s infinite ease-in-out; }
      
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      
      body {
        -webkit-tap-highlight-color: transparent;
        user-select: none;
      }
      
      input, textarea {
        user-select: text;
      }

      /* Christmas Frame Styles */
      .spruce-branch {
        background-image: radial-gradient(circle at 2px 2px, #064e3b 1px, transparent 0);
        background-size: 4px 4px;
        position: relative;
      }
      .spruce-branch::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(45deg, #064e3b 25%, #065f46 50%, #064e3b 75%);
        opacity: 0.4;
      }

      .christmas-toy {
        animation: toySwing 3s infinite ease-in-out;
      }

      .rain-line {
        width: 1px;
        height: 100%;
        background: linear-gradient(to bottom, transparent, #ffd700, transparent);
        animation: rainGlow 2s infinite ease-in-out;
      }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body class="bg-[#0f0c29] text-white overflow-x-hidden">
    <div id="root"></div>

    <!-- React Application Logic -->
    <script type="module">
        import React, { useState, useEffect, useRef } from 'https://esm.sh/react@19';
        import ReactDOM from 'https://esm.sh/react-dom@19/client';

        // --- Image Utilities ---
        const compressImage = (file, maxWidth = 800) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        if (width > maxWidth) {
                            height *= maxWidth / width;
                            width = maxWidth;
                        }
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        resolve(canvas.toDataURL('image/jpeg', 0.6));
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        };

        // --- Main App Component ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('planner');
            const [items, setItems] = useState([]);
            const [cards, setCards] = useState([]);
            const [theme, setTheme] = useState('dark');
            const [isShoppingMode, setIsShoppingMode] = useState(false);
            const [viewingCard, setViewingCard] = useState(null);
            
            const wakeLockRef = useRef(null);
            const cardInputRef = useRef(null);
            const currentCardIndex = useRef(null);

            // Persistence
            useEffect(() => {
                const savedTheme = localStorage.getItem('neon-theme');
                const savedItems = localStorage.getItem('neon-data-v7');
                const savedCards = localStorage.getItem('neon-cards-v7');

                if (savedTheme) setTheme(savedTheme === 'true' ? 'light' : 'dark');
                if (savedItems) {
                    const parsed = JSON.parse(savedItems);
                    setItems(parsed.map(i => ({ ...i, id: i.id || Math.random().toString(36).substr(2, 9) })));
                } else {
                    setItems([{ id: 'init', text: '', checked: false, price: '' }]);
                }
                if (savedCards) setCards(JSON.parse(savedCards));
            }, []);

            useEffect(() => {
                localStorage.setItem('neon-theme', theme === 'light' ? 'true' : 'false');
                localStorage.setItem('neon-data-v7', JSON.stringify(items));
                localStorage.setItem('neon-cards-v7', JSON.stringify(cards));
            }, [theme, items, cards]);

            // Wake Lock
            useEffect(() => {
                const manageWakeLock = async () => {
                    if (isShoppingMode && 'wakeLock' in navigator) {
                        try { wakeLockRef.current = await navigator.wakeLock.request('screen'); } catch (err) {}
                    } else if (wakeLockRef.current) {
                        await wakeLockRef.current.release();
                        wakeLockRef.current = null;
                    }
                };
                manageWakeLock();
            }, [isShoppingMode]);

            // Handlers
            const handleAddItem = () => {
                setItems([...items, { id: Math.random().toString(36).substr(2, 9), text: '', checked: false, price: '' }]);
            };

            const updateItem = (id, updates) => {
                setItems(items.map(item => item.id === id ? { ...item, ...updates } : item));
            };

            const removeItem = (id) => {
                setItems(items.filter(item => item.id !== id));
            };

            const moveCheckedItems = (direction) => {
                setItems(prevItems => {
                    const newItems = [...prevItems];
                    const checkedIndices = newItems
                        .map((item, index) => item.checked ? index : -1)
                        .filter(index => index !== -1);

                    if (direction === 'up') {
                        for (const index of checkedIndices) {
                            if (index > 0) {
                                [newItems[index], newItems[index - 1]] = [newItems[index - 1], newItems[index]];
                            }
                        }
                    } else {
                        for (let i = checkedIndices.length - 1; i >= 0; i--) {
                            const index = checkedIndices[i];
                            if (index < newItems.length - 1) {
                                [newItems[index], newItems[index + 1]] = [newItems[index + 1], newItems[index]];
                            }
                        }
                    }
                    return newItems;
                });
            };

            const handleCardUpload = async (e) => {
                const file = e.target.files?.[0];
                if (file) {
                    const compressed = await compressImage(file);
                    if (currentCardIndex.current !== null) {
                        const newCards = [...cards];
                        newCards[currentCardIndex.current] = compressed;
                        setCards(newCards);
                        currentCardIndex.current = null;
                    } else {
                        setCards([...cards, compressed]);
                    }
                }
            };

            const exportBackup = () => {
                const data = { items, cards, theme };
                const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `neon_planner_backup.json`;
                a.click();
            };

            const importBackup = (e) => {
                const file = e.target.files?.[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (data.items) setItems(data.items);
                        if (data.cards) setCards(data.cards);
                        if (data.theme) setTheme(data.theme);
                        alert("Ð”Ð°Ð½Ð½Ñ‹Ðµ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹!");
                    } catch (err) { alert("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð°!"); }
                };
                reader.readAsText(file);
            };

            const totalSum = items.reduce((acc, i) => acc + (parseFloat(i.price) || 0), 0);
            const paidSum = items.reduce((acc, i) => acc + (i.checked ? (parseFloat(i.price) || 0) : 0), 0);
            const displayedItems = isShoppingMode ? items.filter(i => !i.checked) : items;

            return React.createElement('div', { 
                className: `min-h-screen transition-colors duration-300 relative ${theme === 'dark' ? 'bg-[#0f0c29] text-white' : 'bg-[#e0eafc] text-[#24243e]'}` 
            }, [
                // --- CHRISTMAS FRAME DECORATION ---
                // Spruce Top Bar
                React.createElement('div', {
                    key: 'spruce-top',
                    className: "fixed top-0 left-0 w-full h-8 z-[60] spruce-branch shadow-lg flex justify-around items-end overflow-visible pointer-events-none"
                }, [
                    React.createElement('span', { key: 't1', className: "christmas-toy text-2xl -mb-4" }, 'ðŸ”´'),
                    React.createElement('span', { key: 't2', className: "christmas-toy text-xl -mb-2 delay-75" }, 'ðŸ””'),
                    React.createElement('span', { key: 't3', className: "christmas-toy text-2xl -mb-4 delay-150" }, 'ðŸŸ¡'),
                    React.createElement('span', { key: 't4', className: "christmas-toy text-xl -mb-2 delay-200" }, 'ðŸŽ'),
                    React.createElement('span', { key: 't5', className: "christmas-toy text-2xl -mb-4 delay-300" }, 'ðŸ”´')
                ]),

                // Side Rain (Tinsel)
                React.createElement('div', { key: 'rain-left', className: "fixed left-0 top-0 h-full w-4 flex justify-around pointer-events-none z-[55] opacity-40" }, 
                    [1,2,3].map(i => React.createElement('div', { key: i, className: "rain-line" }))
                ),
                React.createElement('div', { key: 'rain-right', className: "fixed right-0 top-0 h-full w-4 flex justify-around pointer-events-none z-[55] opacity-40" }, 
                    [1,2,3].map(i => React.createElement('div', { key: i, className: "rain-line" }))
                ),

                // Corner Spruce Branches
                React.createElement('div', { key: 'c-tl', className: "fixed top-0 left-0 w-24 h-24 z-[70] pointer-events-none opacity-80" }, 
                    React.createElement('span', { className: "text-4xl absolute top-2 left-2" }, 'ðŸŒ²')
                ),
                React.createElement('div', { key: 'c-tr', className: "fixed top-0 right-0 w-24 h-24 z-[70] pointer-events-none opacity-80 scale-x-[-1]" }, 
                    React.createElement('span', { className: "text-4xl absolute top-2 left-2" }, 'ðŸŒ²')
                ),
                React.createElement('div', { key: 'c-bl', className: "fixed bottom-0 left-0 w-24 h-24 z-[70] pointer-events-none opacity-80 scale-y-[-1]" }, 
                    React.createElement('span', { className: "text-4xl absolute top-2 left-2" }, 'ðŸŒ²')
                ),
                React.createElement('div', { key: 'c-br', className: "fixed bottom-0 right-0 w-24 h-24 z-[70] pointer-events-none opacity-80 scale-x-[-1] scale-y-[-1]" }, 
                    React.createElement('span', { className: "text-4xl absolute top-2 left-2" }, 'ðŸŒ²')
                ),

                // Existing Tinsel Text (for extra layering)
                React.createElement('div', { 
                    key: 'tinsel',
                    className: "fixed top-0 left-0 w-full overflow-hidden whitespace-nowrap opacity-20 pointer-events-none z-50 text-2xl text-[#ffd700] select-none"
                }, "||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||"),

                React.createElement('div', { key: 'main', className: "max-w-xl mx-auto px-4 py-12 relative z-10" }, [
                    // Top Controls
                    React.createElement('div', { key: 'controls', className: "flex justify-between items-center mb-6" }, [
                        React.createElement('button', {
                            key: 'theme-btn',
                            onClick: () => setTheme(theme === 'dark' ? 'light' : 'dark'),
                            className: "w-12 h-12 rounded-full border border-[#ffd700] flex items-center justify-center bg-white/10 hover:bg-white/20 transition-all text-xl shadow-[0_0_10px_rgba(255,215,0,0.3)]"
                        }, theme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™'),
                        React.createElement('button', {
                            key: 'shop-btn',
                            onClick: () => setIsShoppingMode(!isShoppingMode),
                            className: `w-12 h-12 rounded-full border border-[#ffd700] flex items-center justify-center transition-all text-xl ${isShoppingMode ? 'bg-[#ffd700] shadow-[0_0_15px_#ffd700] text-black' : 'bg-white/10 shadow-[0_0_10px_rgba(255,215,0,0.3)]'}`
                        }, 'âš¡')
                    ]),

                    // Tabs
                    React.createElement('div', { key: 'tabs', className: "flex justify-center gap-4 mb-6" }, [
                        React.createElement('button', {
                            key: 'tab-p',
                            onClick: () => setActiveTab('planner'),
                            className: `px-6 py-3 rounded-2xl border border-[#ffd700] font-bold transition-all ${activeTab === 'planner' ? 'bg-[#ffd700] text-black shadow-[0_0_15px_#ffd700]' : 'bg-white/10'}`
                        }, 'ðŸ“ Ð¡Ð¿Ð¸ÑÐ¾Ðº'),
                        React.createElement('button', {
                            key: 'tab-c',
                            onClick: () => setActiveTab('cards'),
                            className: `px-6 py-3 rounded-2xl border border-[#ffd700] font-bold transition-all ${activeTab === 'cards' ? 'bg-[#ffd700] text-black shadow-[0_0_15px_#ffd700]' : 'bg-white/10'}`
                        }, 'ðŸ’³ ÐšÐ°Ñ€Ñ‚Ñ‹')
                    ]),

                    // Content
                    React.createElement('div', { key: 'content', className: "min-h-[50vh]" }, [
                        activeTab === 'planner' ? React.createElement('div', { key: 'planner-view' }, [
                            React.createElement('div', { className: "flex items-stretch gap-2 mb-6" }, [
                                React.createElement('button', {
                                    key: 'm-down',
                                    onClick: () => moveCheckedItems('down'),
                                    className: "w-10 rounded-2xl border border-[#ffd700] bg-white/5 flex items-center justify-center text-[#ffd700] hover:bg-[#ffd700]/20 transition-all active:scale-95 text-xl font-bold shadow-inner"
                                }, 'â†“'),
                                React.createElement('div', { className: "flex-1 bg-black/20 border-2 border-[#32cd32] rounded-2xl p-4 max-h-[65vh] overflow-y-auto no-scrollbar space-y-3 shadow-2xl backdrop-blur-sm" }, [
                                    displayedItems.length === 0 && React.createElement('div', { className: "text-center py-8 opacity-50 italic" }, isShoppingMode ? "Ð’ÑÐµ ÐºÑƒÐ¿Ð»ÐµÐ½Ð¾!" : "Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¿ÑƒÑÑ‚"),
                                    displayedItems.map(item => React.createElement('div', {
                                        key: item.id,
                                        className: `flex items-center gap-3 p-3 rounded-xl transition-all overflow-x-auto no-scrollbar ${item.checked ? 'bg-[#32cd32]/20 opacity-80 border-[#32cd32]/40 border' : 'bg-white/5 border border-white/10'}`
                                    }, React.createElement('div', { className: "flex items-center gap-3 min-w-full" }, [
                                        React.createElement('input', {
                                            type: 'checkbox',
                                            checked: item.checked,
                                            onChange: (e) => updateItem(item.id, { checked: e.target.checked }),
                                            className: "w-5 h-5 accent-[#32cd32] shrink-0"
                                        }),
                                        React.createElement('textarea', {
                                            value: item.text,
                                            onChange: (e) => updateItem(item.id, { text: e.target.value }),
                                            placeholder: "ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ...",
                                            className: "flex-1 bg-transparent border-none outline-none resize-none text-sm p-1 placeholder:opacity-50 h-8 no-scrollbar min-w-[150px]"
                                        }),
                                        React.createElement('div', { className: "flex items-center gap-2 shrink-0" }, [
                                            React.createElement('input', {
                                                type: 'number',
                                                value: item.price,
                                                onChange: (e) => updateItem(item.id, { price: e.target.value }),
                                                placeholder: "0",
                                                className: "w-16 bg-white/10 text-center rounded-lg p-1 font-bold text-xs"
                                            }),
                                            React.createElement('button', {
                                                onClick: () => removeItem(item.id),
                                                className: "w-8 h-8 rounded-lg bg-red-600/80 flex items-center justify-center font-bold hover:bg-red-700 transition-colors"
                                            }, 'âœ•')
                                        ])
                                    ])))
                                ]),
                                React.createElement('button', {
                                    key: 'm-up',
                                    onClick: () => moveCheckedItems('up'),
                                    className: "w-10 rounded-2xl border border-[#ffd700] bg-white/5 flex items-center justify-center text-[#ffd700] hover:bg-[#ffd700]/20 transition-all active:scale-95 text-xl font-bold shadow-inner"
                                }, 'â†‘')
                            ]),
                            // Totals
                            React.createElement('div', { className: "bg-black/40 border-2 border-dashed border-[#ffd700] rounded-2xl p-4 text-right mb-6 shadow-lg" }, [
                                React.createElement('div', { className: "text-lg" }, ['ðŸ’° Ð˜Ñ‚Ð¾Ð³Ð¾: ', React.createElement('strong', { className: "text-[#ffd700]" }, totalSum.toFixed(2) + ' â‚½')]),
                                React.createElement('div', { className: "text-[#32cd32] text-sm" }, ['ðŸŽ ÐšÑƒÐ¿Ð»ÐµÐ½Ð¾: ', React.createElement('strong', null, paidSum.toFixed(2) + ' â‚½')])
                            ]),
                            // Add button
                            React.createElement('button', {
                                onClick: handleAddItem,
                                className: "w-full max-w-sm mx-auto block py-4 bg-gradient-to-r from-[#32cd32] to-[#1e5d3a] rounded-2xl font-bold text-lg shadow-[0_5px_15px_rgba(50,205,50,0.4)] hover:brightness-110 active:scale-95 transition-all"
                            }, 'â„ï¸ Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾ÐºÑƒÐ¿ÐºÑƒ')
                        ]) : React.createElement('div', { key: 'cards-view' }, [
                            React.createElement('div', { className: "grid grid-cols-2 gap-4 mb-8" }, [
                                cards.map((src, idx) => React.createElement('div', {
                                    key: idx,
                                    className: "relative aspect-[3/2] rounded-xl overflow-hidden border-2 border-dashed border-[#ffd700] group cursor-pointer shadow-lg"
                                }, [
                                    React.createElement('img', { src, className: "w-full h-full object-cover", onClick: () => setViewingCard(src) }),
                                    React.createElement('div', { className: "absolute top-2 right-2 flex gap-2" }, [
                                        React.createElement('button', { onClick: () => { currentCardIndex.current = idx; cardInputRef.current.click(); }, className: "w-8 h-8 rounded-full bg-[#ffd700] text-black flex items-center justify-center font-bold shadow-md" }, 'âœŽ'),
                                        React.createElement('button', { onClick: () => setCards(cards.filter((_, i) => i !== idx)), className: "w-8 h-8 rounded-full bg-red-600 text-white flex items-center justify-center font-bold shadow-md" }, 'âœ•')
                                    ])
                                ])),
                                React.createElement('div', {
                                    onClick: () => { currentCardIndex.current = null; cardInputRef.current.click(); },
                                    className: "aspect-[3/2] rounded-xl border-2 border-dashed border-[#ffd700] bg-white/5 flex flex-col items-center justify-center cursor-pointer text-[#ffd700] font-bold text-center p-2 hover:bg-white/10 transition-colors"
                                }, [
                                    React.createElement('span', { className: "text-3xl mb-1" }, 'ï¼‹'),
                                    React.createElement('span', { className: "text-[10px] leading-tight" }, 'Ð”ÐžÐ‘ÐÐ’Ð˜Ð¢Ð¬ ÐšÐÐ Ð¢Ð£')
                                ])
                            ]),
                            React.createElement('input', { type: 'file', ref: cardInputRef, className: "hidden", accept: "image/*", onChange: handleCardUpload })
                        ])
                    ]),

                    // Footer Tools
                    React.createElement('div', { className: "flex justify-center gap-3 mt-8 py-6 border-t border-white/10" }, [
                        React.createElement('button', { onClick: exportBackup, className: "px-4 py-2 text-[10px] rounded-lg border border-[#ffd700] bg-white/5 uppercase tracking-wider font-bold hover:bg-[#ffd700]/10 transition-colors" }, 'ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð±ÑÐºÐ°Ð¿'),
                        React.createElement('button', { onClick: () => document.getElementById('import-file').click(), className: "px-4 py-2 text-[10px] rounded-lg border border-[#ffd700] bg-white/5 uppercase tracking-wider font-bold hover:bg-[#ffd700]/10 transition-colors" }, 'ðŸ“‚ Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ'),
                        React.createElement('input', { type: 'file', id: "import-file", className: "hidden", accept: ".json", onChange: importBackup })
                    ])
                ]),

                // Modal
                viewingCard && React.createElement('div', {
                    onClick: () => setViewingCard(null),
                    className: "fixed inset-0 bg-black/95 z-[1000] flex items-center justify-center p-4 animate-in fade-in duration-300"
                }, [
                    React.createElement('img', { src: viewingCard, className: "max-w-full max-h-full rounded-lg shadow-2xl" }),
                    React.createElement('button', { className: "absolute top-6 right-6 text-white text-3xl font-light" }, 'âœ•')
                ])
            ]);
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
